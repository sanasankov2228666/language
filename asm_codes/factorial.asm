PUSH 0
POPREG AX

PUSH 100
POPM [AX]

PUSH 1
POPREG AX

PUSH 100
POPM [AX]

PUSHM [AX]
POPREG BX
JUMP :main

:main

IN

PUSHREG BX
PUSH 0
ADD
POPREG FX
POPM [FX]
PUSHM [AX]
PUSH 1
ADD
POPM [AX]

PUSHREG BX
PUSH 0
ADD
POPREG FX
PUSHM [FX]
CALL :factorial
PUSHREG GX

PUSHREG BX
PUSH 1
ADD
POPREG FX
POPM [FX]
PUSHM [AX]
PUSH 1
ADD
POPM [AX]

PUSHREG BX
PUSH 1
ADD
POPREG FX
PUSHM [FX]

OUT

JUMP :end_program

:factorial

PUSHM [AX]
POPREG BX
PUSHREG AX
PUSH 1
ADD
POPREG AX
PUSHREG BX
POPM [AX]

PUSHREG BX
PUSH 0
ADD
POPREG FX
POPM [FX]
PUSHM [AX]
PUSH 1
ADD
POPM [AX]

PUSHREG BX
PUSH 0
ADD
POPREG FX
PUSHM [FX]
PUSH 1

PUSH 0
POPREG CX
JA :cond_end1
PUSH 1
POPREG CX
JUMP :cond_end1
:cond_end1
PUSHREG CX

PUSH 0
JE :endif1
PUSH 1
POPREG GX
PUSHREG AX

PUSH 1
SUB
POPREG AX
PUSHM [AX]
POPREG BX
RET
:endif1


PUSHREG BX
PUSH 0
ADD
POPREG FX
PUSHM [FX]

PUSHREG BX
PUSH 0
ADD
POPREG FX
PUSHM [FX]
PUSH 1
SUB
CALL :factorial
PUSHREG GX
MULT
POPREG GX
PUSHREG AX

PUSH 1
SUB
POPREG AX
PUSHM [AX]
POPREG BX
RET
:end_program

HLT
